{% extends "postman/base.html" %}
{% load i18n postman_tags widget_tweaks %}

{% block page_title %}{% trans "Message" %}{{ block.super }}{% endblock %}

{% block breadcrumb %}
    {{ block.super }}
    <li class="active">{% trans "TODO breadcrumb" %}</li>
{% endblock %}

{% block postman_content %}

<!-- a box with semi transparent background -->
<div class="content-box">
    
    {% for message in pm_messages %}
    
	    <div class="btn btn-emphasized w100">
	        <ul class="media-list">
	            <li class="media">
	                <a class="pull-left" href="#">
	                    <i class="fa fa-user"></i>
	                </a>
	                <div class="media-body">
	                    <a href="documents-edit.html">
	                        <span class="annotation" data-date="{{ message.sent_at }}"></span>
	                        <strong>{{ message.obfuscated_sender|or_me:user }}</strong>
	                        {{ message.subject }}
	                    </a>
	                </div>
	            </li>
	        </ul>
	    </div>
	    <p class="regular-space">{{ message.body|linebreaksbr }}</p>
    
    {% endfor %}

    {% if reply_to_pk %}
    <form action="{% url 'postman_reply' reply_to_pk %}?next={{ next_url|urlencode }}" method="post">{% csrf_token %}
	    
	    <div class="btn btn-emphasized w100">
	        <ul class="media-list">
	            <li class="media">
	                <a class="pull-left" href="#">
	                    <i class="fa fa-pencil"></i>
	                </a>
	                <div class="media-body">
	                    <a href="documents-edit.html">
	                        {% trans "Answer" %}
	                    </a>
	                </div>
	            </li>
	        </ul>
	    </div>
	
	    {{ form.body|add_class:"app-message-text" }}
	    
	    <button type="submit" class="btn btn-emphasized app-message-send-button">
	        <ul class="media-list">
	            <li class="media">
	                <a class="pull-left" href="#">
	                    <i class="fa fa-pencil"></i>
	                </a>
	                <div class="media-body">
	                    {% trans 'Reply' %}
	                </div>
	            </li>
	        </ul>
	    </button>
	</form>
    {% endif %}

</div><!-- content-box -->

{% with pm_messages.all|first as message %}

	<form action="" method="post">{% csrf_token %}
		<input type="hidden" {% if pm_messages|length > 1 and message.thread_id %}name="tpks" value="{{ message.thread_id }}"{% else %}name="pks" value="{{ message.pk }}"{% endif %} />
		
		<button type="submit"  onclick="this.form.action='{% url 'postman_delete' %}?next={{ next_url|urlencode }}'" class="btn btn-emphasized">
		    <ul class="media-list">
		        <li class="media">
		            <a class="pull-left" href="#">
		                <i class="fa fa-eraser"></i>
		            </a>
		            <div class="media-body">
		                {% trans "Delete" %}
		            </div>
		        </li>
		    </ul>
		</button>
		
		{% if not archived %}
		<button type="submit" onclick="this.form.action='{% url 'postman_archive' %}?next={{ next_url|urlencode }}'" class="btn btn-emphasized">
		    <ul class="media-list">
		        <li class="media">
		            <a class="pull-left" href="#">
		                <i class="fa fa-folder"></i>
		            </a>
		            <div class="media-body">
		                {% trans "Archive" %}
		            </div>
		        </li>
		    </ul>
		</button>
		{% endif %}
		
	</form>

{% endwith %}

{% endblock %}